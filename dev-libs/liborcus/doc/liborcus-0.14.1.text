#!/lib/shell/env bash5
# Copyright (C) 2019 Artem Slepnev, Shellgen
# License GPLv3+: GNU GPL version 3 or later
# gnu.org/licenses/gpl.html



if [[ ${EBUILD_PHASE-} == install ]]; then
   if declare -F after_src_$EBUILD_PHASE &> /dev/null; then
      # error - color: red
      printf " \e[;31m++\e[m ${BASH_SOURCE##*/} after_src_$EBUILD_PHASE... error\n"
      return 1
   else
      after_src_install() {
         set -o errexit -o pipefail -o nounset
         unset -f $FUNCNAME
         if [[ $MULTILIB_ABIS == amd64* ]]; then
            if [[ -x ${ED}/usr/${LIBDIR_amd64}/${PN}-${PV%.*}.so.0.0.0 &&
             ! -x ${ED}/usr/${LIBDIR_amd64}/${PN}-0.13.so.0 ]]; then
               ln -sr ${ED}/usr/${LIBDIR_amd64}/${PN}-${PV%.*}.so.0.0.0 \
                ${ED}/usr/${LIBDIR_amd64}/${PN}-0.13.so.0
               ln -sr ${ED}/usr/${LIBDIR_amd64}/${PN}-parser-${PV%.*}.so.0.0.0 \
                ${ED}/usr/${LIBDIR_amd64}/${PN}-parser-0.13.so.0
               # ok - color: green
               printf " \e[1;3m+\e[m ebuild/$CATEGORY/$PN... $FUNCNAME\n"
            fi
         fi
         set +o nounset +o pipefail +o errexit
      }
   fi
fi