#!/lib/shell/env bash5
# Copyright (C) 2019 Artem Slepnev, Shellgen
# License GPLv3+: GNU GPL version 3 or later
# gnu.org/licenses/gpl.html


if [[ ${EBUILD_PHASE-} == setup ]]; then
   # x86_64 depend
   if [[ $MULTILIB_ABIS == amd64*x32 ]]; then
      unset -v ABI_DEFAULT

      declare -grx DEFAULT_ABI=${MULTILIB_ABIS%% *}
      declare -grx ABI=$DEFAULT_ABI
      declare -grx ABI_X86=64
      declare -grx BITS=$ABI_X86
      declare -grx MULTILIB_ABIS=$DEFAULT_ABI
      declare -grx CFLAGS_default=${CFLAGS_amd64}
      declare -grx CFLAGS+=\ ${CFLAGS_default}
      declare -grx CXXFLAGS+=\ ${CFLAGS_default}
      declare -grx LDFLAGS_default=${LDFLAGS_amd64}
      #LDFLAGS=${LDFLAGS/$LIBDIR_x32/$LIBDIR_amd64}
      declare -grx LDFLAGS+=\ ${CFLAGS_default}
      #LDFLAGS+=" -L/usr/${LIBDIR_amd64} ${CFLAGS_default}"
      declare -grx CHOST_default=${CHOST_amd64}
      declare -grx CHOST=$CHOST_default
      declare -grx CBUILD=$CHOST
      declare -grx CTARGET_default=$CBUILD
      declare -grx CTARGET=${CTARGET_default}
      declare -grx LIBDIR_default=${LIBDIR_amd64}
      declare -grx LD_LIBRARY_PATH=/usr/${LIBDIR_default}
      # ok - color: green
      printf " \e[1;3m+\e[m ebuild/$CATEGORY/$PN... abi_x86_64\n"
   fi
fi

#if [[ $MULTILIB_ABIS == amd64 && $ABI == amd64 ]]; then
#   #declare -gx CHOST=${CHOST_amd64}
#   declare -gx LIBDIR_default=${LIBDIR_amd64}
#   declare -gx LD_LIBRARY_PATH=/usr/${LIBDIR_default}
#fi

# unset
#  CFLAGS_x32
#  CFLAGS_x86
#  CHOST_x32
#  CHOST_x86
#  LDFLAGS_x32
#  LDFLAGS_x86
#  LIBDIR_x32
#  LIBDIR_x86
#  MULTILIB_ECLASS
#  _MULTILIB_ECLASS